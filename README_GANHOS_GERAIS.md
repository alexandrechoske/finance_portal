# Ganhos Gerais - Tela Reformulada

## Visão Geral

A tela de "Freelas" foi completamente reformulada para se tornar **"Ganhos Gerais"** - uma base consolidada para gerenciar todos os tipos de ganhos mensais (freelances, salário, dividendos, mineração, etc.).

## Principais Mudanças

### ✅ Funcionalidades Implementadas

1. **Interface Moderna**
   - Design responsivo com Tailwind CSS
   - Cards de métricas principais
   - Layout profissional com sombras e gradientes

2. **CRUD Completo com Modal Popup**
   - Modal responsivo para criar/editar ganhos
   - Formulário com validação HTML5
   - Dropdowns de categorias e classes com opção de adicionar novas
   - Botão de exclusão integrado

3. **Gráficos Interativos**
   - Gráfico de barras para evolução mensal
   - Gráfico de rosca para distribuição por categoria
   - Atualização automática com base nos filtros

4. **Sistema de Filtros Avançado**
   - Filtro por mês específico
   - Filtro por categoria
   - Filtro por classe/tipo
   - Busca textual na descrição
   - Aplicação de filtros em tempo real

5. **Tabela Responsiva**
   - Paginação inteligente
   - Controles de itens por página
   - Formatação automática de valores em R$
   - Ações de editar/excluir por linha

6. **Integração Completa com Supabase**
   - Remoção total da integração com Google Apps Script
   - API endpoints dedicados (`/api/ganhos/*`)
   - Operações CRUD otimizadas
   - Agregações server-side para performance

## Estrutura da Tabela

```sql
CREATE TABLE public.ganhos_gerais (
  id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  dt_lcto text NULL,
  des_lcto text NULL,
  vlr_lcto text NULL,
  categoria_lcto text NULL,
  classe_lcto text NULL,
  CONSTRAINT ganhos_gerais_pkey PRIMARY KEY (id)
);
```

## Setup e Configuração

### 1. Criar Tabela no Supabase

Execute o SQL completo disponível em `sql/ganhos_gerais.sql`:

```bash
# No painel do Supabase, vá para SQL Editor e execute o conteúdo do arquivo
cat sql/ganhos_gerais.sql
```

### 2. Verificar Variáveis de Ambiente

Certifique-se de que as seguintes variáveis estão configuradas:

```bash
SUPABASE_URL=https://seu-projeto.supabase.co
SUPABASE_ANON_KEY=sua-chave-anonima
```

### 3. Executar o Flask

```bash
python app.py
```

### 4. Importar Dados de Exemplo (Opcional)

**Opção 1 - PowerShell:**
```powershell
./scripts/import_ganhos_exemplo.ps1
```

**Opção 2 - Python:**
```bash
python scripts/import_ganhos_exemplo.py
```

**Opção 3 - cURL:**
```bash
curl -X POST http://localhost:5000/api/ganhos/import \
  -H "Content-Type: application/json" \
  -d @scripts/dados_exemplo.json
```

## API Endpoints

### Principais Rotas Implementadas

| Método | Rota | Descrição |
|--------|------|-----------|
| `GET` | `/api/ganhos` | Lista ganhos com filtros e agregações |
| `POST` | `/api/ganhos` | Cria novo ganho |
| `PUT` | `/api/ganhos/<id>` | Atualiza ganho existente |
| `DELETE` | `/api/ganhos/<id>` | Exclui ganho |
## Ganhos Gerais - Guia Rápido

- Página: `/freelas` (UI moderna com cards, filtros, gráficos e CRUD em modal).
- Dados: carregados via `/api/ganhos` (padrão das outras páginas).
- CRUD: POST/PUT/DELETE em `/api/ganhos` e importação em lote em `/api/ganhos/import`.

Como usar
- Crie a tabela no Supabase: `sql/ganhos_gerais.sql`.
- Rode o app: `python app.py` (porta 3000).
- Importe exemplos: `scripts/import_ganhos_exemplo.ps1` (Windows) ou `scripts/import_ganhos_exemplo.py`.

Endpoints
- GET /api/ganhos?per_page=1000&month=YYYY-MM&categoria=...&classe=...&search=...
- POST /api/ganhos
- PUT /api/ganhos/<id>
- DELETE /api/ganhos/<id>
- POST /api/ganhos/import (array JSON)
- GET /api/debug/ganhos-raw (debug)

Campos esperados
- dt_lcto (YYYY-MM-DD), des_lcto (texto), vlr_lcto (número/str), categoria_lcto (texto), classe_lcto (texto)

Problemas comuns
- 42P01: execute o SQL da tabela.
- 401/CORS: verifique SUPABASE_URL/SUPABASE_ANON_KEY.
- Sem dados: importe exemplos.
      "Freelance": 298.50,
